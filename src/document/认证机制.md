### 认证机制

## 一、发展史

1、最初方案是服务端发sessionID给了客户端，然后客户端再将sessionID再返回给服务端，这样就可以实现认证机制了。

![微信截图_20220403133829](E:\LearningDocument\Github\resources\微信截图_20220403133829.png)

但是因为服务集群需要将id来回搬运，很麻烦，所以将所有的sessionID存在了一个地方。如下所示：

![微信截图_20220403133851](E:\LearningDocument\Github\resources\微信截图_20220403133851.png)

但是存储session的机器也挂了呢？这样的话就更头疼了。

2、针对上面的这个问题，可以使用对数据进行签名的方式解决，比如说用HMAC-SHA256算法，加上一个仅服务器知道的秘钥，对数据进行签名，把这个签名和数据一起作为token。

![微信截图_20220403134741](E:\LearningDocument\Github\resources\微信截图_20220403134741.png)

这个token不用保存，当客户端把token再发过来的时候，只需要用HMAC-SH256算法和同样的秘钥对数据再计算一次签名，再和token的签名进行比较，如果相同就知道已经登录过了，并且可以取到user id，如果不相同数据肯定被篡改过，则无法通过认证。

![微信截图_20220403134750](E:\LearningDocument\Github\resources\微信截图_20220403134750.png)

## 二、理解Cookie

一句话进行解释就是Cookie是浏览器存储的一种数据，cookie由服务端生成，发送给浏览器，浏览器再把它存在目录下面，以k-v的格式存储。

### 三、理解session

session从字面上面看就是会话，服务器使用session把用户的信息临时保存在了服务器上面，用户离开网站后session被销毁，这种用户信息存储方式相对于cookie来说更加安全，但是session有一个缺陷，如果web服务器做了负载均衡，那么下一个操作请求到了另一台服务器的时候session会丢失。

### 四、理解token

同上面的发展史。